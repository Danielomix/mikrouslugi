// MongoDB script to clean ALL microservices databases while preserving admin user
print('ğŸ§¹ CLEANING ALL MICROSERVICES DATABASES ğŸ§¹\n');

// Main database (auth, products)
use mikrouslugi;
print('ğŸ“ Database: mikrouslugi');

const adminUser = db.users.findOne({
  email: 'test@example.com',
  role: 'admin'
});

if (!adminUser) {
  print('âŒ Admin user test@example.com not found in main database!');
} else {
  print('ğŸ›¡ï¸  Preserving admin user: ' + adminUser.email);
  
  // Clean main database but keep admin user
  const productsResult = db.products.deleteMany({});
  print('   âœ… Products deleted: ' + productsResult.deletedCount);
  
  const usersResult = db.users.deleteMany({
    _id: { $ne: adminUser._id }
  });
  print('   âœ… Users deleted: ' + usersResult.deletedCount + ' (kept admin)');
}

const inventoriesResult = db.inventories.deleteMany({});
print('   âœ… Inventories deleted: ' + inventoriesResult.deletedCount);

print('\nğŸ“ Database: mikrouslugi_orders');
use mikrouslugi_orders;
const ordersResult = db.orders.deleteMany({});
print('   âœ… Orders deleted: ' + ordersResult.deletedCount);

print('\nğŸ“ Database: mikrouslugi_payments');
use mikrouslugi_payments;
const paymentsResult = db.payments.deleteMany({});
print('   âœ… Payments deleted: ' + paymentsResult.deletedCount);

print('\nğŸ“ Database: mikrouslugi_inventory');
use mikrouslugi_inventory;
const inventoryItemsResult = db.inventories.deleteMany({});
print('   âœ… Inventory items deleted: ' + inventoryItemsResult.deletedCount);

print('\nğŸ“Š FINAL VERIFICATION:');
use mikrouslugi;
print('mikrouslugi - users: ' + db.users.countDocuments());
print('mikrouslugi - products: ' + db.products.countDocuments());
print('mikrouslugi - inventories: ' + db.inventories.countDocuments());

use mikrouslugi_orders;
print('mikrouslugi_orders - orders: ' + db.orders.countDocuments());

use mikrouslugi_payments;
print('mikrouslugi_payments - payments: ' + db.payments.countDocuments());

use mikrouslugi_inventory;
print('mikrouslugi_inventory - inventories: ' + db.inventories.countDocuments());

print('\nğŸ‰ ALL DATABASES CLEANED SUCCESSFULLY!');
print('ğŸ‘¤ Admin user preserved: test@example.com');