// MongoDB script to clean database while preserving admin user
use mikrouslugi;

print('ğŸ”Œ Connected to mikrouslugi database');

print('\nğŸ“Š Current database state:');
print('   users: ' + db.users.countDocuments());
print('   products: ' + db.products.countDocuments());
print('   orders: ' + db.orders.countDocuments());
print('   payments: ' + db.payments.countDocuments());
print('   inventories: ' + db.inventories.countDocuments());

// Find admin user to preserve
const adminUser = db.users.findOne({
  email: 'test@example.com',
  role: 'admin'
});

if (!adminUser) {
  print('âŒ Admin user test@example.com not found!');
  quit();
}

print('\nğŸ›¡ï¸  Preserving admin user: ' + adminUser.email + ' (' + adminUser.name + ')');

print('\nğŸ§¹ Cleaning collections...');

// Delete all products
const productsResult = db.products.deleteMany({});
print('   âœ… Products deleted: ' + productsResult.deletedCount);

// Delete all orders
const ordersResult = db.orders.deleteMany({});
print('   âœ… Orders deleted: ' + ordersResult.deletedCount);

// Delete all payments
const paymentsResult = db.payments.deleteMany({});
print('   âœ… Payments deleted: ' + paymentsResult.deletedCount);

// Delete all inventory
const inventoryResult = db.inventories.deleteMany({});
print('   âœ… Inventory deleted: ' + inventoryResult.deletedCount);

// Delete all users except admin
const usersResult = db.users.deleteMany({
  _id: { $ne: adminUser._id }
});
print('   âœ… Users deleted: ' + usersResult.deletedCount + ' (kept admin)');

print('\nğŸ“Š Final database state:');
print('   users: ' + db.users.countDocuments());
print('   products: ' + db.products.countDocuments());
print('   orders: ' + db.orders.countDocuments());
print('   payments: ' + db.payments.countDocuments());
print('   inventories: ' + db.inventories.countDocuments());

print('\nğŸ‰ Database cleanup completed successfully!');
print('ğŸ‘¤ Remaining admin user: ' + adminUser.email);